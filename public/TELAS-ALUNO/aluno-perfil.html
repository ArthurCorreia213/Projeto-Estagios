<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/footer.css">
    
	<!-- <link rel="stylesheet" href="../css/css-admin/admin-adicionar-aluno.css"> -->
	<link rel="stylesheet" href="../css/css-aluno/aluno-perfil.css">
	
	<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
	
    <title>Estágios SENAI MOOCA</title>
</head>
<body>

    <header>
        <div class="logo">
            <img src="../imagens/gerais/LOGO.svg" id="SENAI">
            <h1 id="titulo">PORTAL DE ESTÁGIOS</h1>
        </div>
    </header>

    <article>
        <div class="container">
            <form action="/add_curriculo" method="POST" id="infoAlunoForm">
                <div class="form-columns">
                    <!-- Primeira Coluna -->

                    <div class="form-column">

                        <!-- 
                    NOME: -->
                        <div class="field">
                            <label for="nome">Nome: <span>*</span></label>
                            <input type="text" id="nome" name="nome" disabled>
                        </div>
<!-- 
                        TELEFONE: -->
                        <div class="field">
                            <label for="telefone">Telefone:</label>
                            <input type="tel" id="telefone" name="telefone" maxlength="15" oninput="formatarTELEFONE(this)" disabled value="(11) 4002-89222">
                        </div>
						
						<div class="field">
                            <label for="telefone">Email:</label>
                            <input type="text" id="email" name="email" maxlength="15" oninput="formatarTELEFONE(this)" disabled value="abc@def.com">
                        </div>

                        <div class="field">
                            <label for="cpf">CPF:</label>
                            <input type="text" id="cpf" name="cpf" maxlength="14" oninput="formatarCPF(this)" disabled>
                        </div>

                        <!-- <div class="field">
                            <label for="cpf">CPF: <span>*</span></label>
                            <input type="text" id="cpf" name="cpf" disabled>
                        </div> -->
                        <!-- <div class="field">
                            <label for="ra">R.A.: <span>*</span></label>
                            <input type="text" id="ra" name="ra" disabled>
                        </div> -->
<!-- 
                        NASCIMENTO: -->
                        <div class="field">
                            <label for="data-nascimento">Data de nascimento: <span>*</span></label>
                            <input type="text" id="data-nascimento" name="data-nascimento" disabled value="24/10/2004">
                        </div>
<!-- 
                        Escolaridade: -->
                        <div class="field">
                            <label for="escolaridade">Escolaridade: <span>*</span></label>
                            <input type="text" id="escolaridade" name="escolaridade" disabled>
                        </div>
<!-- 
                        INSCRIÇAO NO CRUSO: -->

                        <div class="field">
                            <label for="data_de_inicio">Data de Inscrição: <span>*</span></label>
                            <input type="text" id="data_de_inicio" name="data_de_inicio" disabled value="00/00/0000">
                        </div>
<!-- 
                        ENDEREÇO: -->

                        <div class="field">
                            <label class="label" for="rua">Rua:</label>
                            <input class="input" type="text" id="rua" name="localizacao" disabled>

                            <label class="label" for="numero">Numero:</label>
                            <input class="input" type="text" id="numero" name="localizacao" disabled>

                            <label class="label" for="complemento">Complemento:</label>
                            <input class="input" type="text" id="complemento" name="localizacao" disabled>

                            <label class="label" for="estado">Estado:</label>
                            <input class="input" type="text" id="estado" name="localizacao" disabled> 

                            <label class="label" for="cidade">Cidade:</label>
                            <input class="input" type="text" id="cidade" name="localizacao" disabled> 
                        </div>
        

                    </div>
    
                    <!-- Segunda Coluna -->
<!-- 
                    CURSO: -->
                    <div class="form-column">
                        <div class="field">
                            <label for="curso">Curso Inscrito: <span>*</span></label>
                            <input type="text" id="curso" name="curso" class="input" disabled>
                        </div>
<!-- 
                        HORARIO DO CURSO: -->
                        <div class="field">
                            <label for="horario">Horário do curso: <span>*</span></label>
                            <input type="text" id="horario" name="horario" disabled value="MANHA">
                        </div>
<!-- 
                        SEMESTRE DO CURSO: -->

                        <div class="field">
                            <label for="semestre">Semestre atual: <span>*</span></label>
                            <input type="text" name="semestre" id="semestre"  disabled>
                        </div>
						
						<div class="field">
                            <label for="habilidades">Habilidades:</label>
                            <input type="text" name="habilidades" id="habilidades">
                        </div>
						
						<div class="field">
                            <label for="experiencia">Expêriencia profissional:</label>
                            <input type="text" name="experiencia" id="experiencia">
                        </div>
						
						<div class="field">
                            <label for="sobre_mim">Sobre mim:</label>
                            <input type="text" name="sobre_mim" id="sobre_mim">
                        </div>
<!-- 
                        CRIANDO LOGIN: -->

                        <div class="buttons">
                            <input type="submit" class="save" value="SALVAR">
                            <button type="reset" class="cancel">CANCELAR</button>
                        </div>


    
                        <!-- <div class="field">
                            <label for="preferencias">Preferências:</label>
                            <textarea id="preferencias" name="preferencias" rows="2"></textarea>
                        </div> -->
                        <!-- <div class="field">
                            <label for="email-senai">Email - SENAI: <span>*</span></label>
                            <input type="email" id="email-senai" name="email-senai" disabled>
                        </div>
                        <div class="field">
                            <label for="email-pessoal">Email - Pessoal: <span>*</span></label>
                            <input type="email" id="email-pessoal" name="email-pessoal" disabled>
                        </div>
                        <div class="field">
                            <label for="celular">Celular: <span>*</span></label>
                            <input type="tel" id="celular" name="celular" disabled>
                        </div>
                        <div class="field">
                            <label for="recado">Recado:</label>
                            <textarea id="recado" name="recado" rows="2"></textarea>
                        </div> -->
                    </div>
                </div>
            </form>
        </div>
    </article>
    <script>



    function preencherFormularioComToken() {
        // Recuperar o token do localStorage
        const token = localStorage.getItem('token');
        if (!token) {
            alert('Token não encontrado. Faça login para continuar.');
            window.location.href = '../login.html'; // Redirecionar para login se necessário
            return;
        }

        try {
            // Decodificar o token
            const decoded = jwt_decode(token);

            alert(JSON.stringify(decoded))
            alert(decoded.user.Nome)

            // Preencher os campos do formulário com os dados do token
            document.getElementById('nome').value = decoded.user.Nome;
            document.getElementById('telefone').value = decoded.user.Telefone;
            document.getElementById('email').value = decoded.user.Email;
            document.getElementById('cpf').value = decoded.user.CPF;
            document.getElementById('data-nascimento').value = decoded.user.Data_Nascimento;
            document.getElementById('escolaridade').value = decoded.user.Escolaridade;
            document.getElementById('data_de_inicio').value = decoded.user.Data_De_Inicio;
            document.getElementById('rua').value = decoded.user.Rua;
            document.getElementById('numero').value = decoded.user.Numero;
            document.getElementById('complemento').value = decoded.user.Complemento;
            document.getElementById('estado').value = decoded.user.Estado;
            document.getElementById('cidade').value = decoded.user.Cidade;
            document.getElementById('curso').value = decoded.user.Curso;
            document.getElementById('horario').value = decoded.user.Horario;
            document.getElementById('semestre').value = decoded.user.Semestre;
            document.getElementById('habilidades').value = decoded.user.Habilidades;
            document.getElementById('experiencia').value = decoded.user.Experiencia;
            document.getElementById('sobre_mim').value = decoded.user.Sobre_Mim;
        } catch (error) {
            console.error('Erro ao decodificar o token:', error);
            alert('Erro ao processar os dados do token. Tente novamente.');
        }
    }

    // Chamar a função ao carregar a página
    window.onload = preencherFormularioComToken();





    document.getElementById('infoAlunoForm').addEventListener('submit', async (event) => { 
	    event.preventDefault(); 
		
		const token = localStorage.getItem('token');
        if (!token) {
            alert('Token não encontrado. Faça login para continuar.');
            window.location.href = '/login'; // Redirecionar para login se necessário
            return;
        }
		const decoded = jwt_decode(token)
			
        const vaga = { 
			habilidades: document.getElementById('habilidades').value,
			experiencia: document.getElementById('experiencia').value,
			sobre_mim: document.getElementById('sobre_mim').value,
			id: decoded.user.ID_Candidato 
			};

        try { 
            const response = await fetch('/add_curriculo', { 
                method: 'POST', 
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`  }, 
                body: JSON.stringify(vaga) 
            }); 
            const message = await response.text();
        } catch (error) { 
            alert('Erro ao enviar dados: ' + error.message); 
        } 
    }); 			
	

    function formatarCPF(cpf){
        let CPF = cpf.value.replace(/\D/g, "")

        CPF = CPF.replace(/^(\d{3})(\d)/, "$1.$2")
        CPF = CPF.replace(/^(\d{3})\.(\d{3})(\d)/, "$1.$2.$3")
        CPF = CPF.replace(/\.(\d{3})(\d{2})/, ".$1-$2")

        cpf.value = CPF
    }

    function formatarTELEFONE(tel) {
        let telefone = tel.value.replace(/\D/g, "");

        // Formatação do telefone com DDD e número
        telefone = telefone.replace(/^(\d{2})(\d)/, "($1) $2");
        telefone = telefone.replace(/^(\d{2}) (\d{5})(\d)/, "($1) $2-$3");
        telefone = telefone.replace(/ (\d{5})(\d)/, " $1-$2")

        tel.value = telefone; 
    }

    function numeros(number){
        let numeros = number.value.replace(/[\D06789]/g, "")

        number.value = numeros
    }

    </script>

    <footer>
        <div id="texto">
            <a href="">FALE CONOSCO</a>
            <a href="">TRABALHE CONOSCO</a>
            <a href="">OUVIDORIA</a>
            <a href="">POLITICA DE PRIVACIDADE</a>
            <a href="">A LGPD NO SENAI-SP</a>
        </div>

        <div id="redes-sociais">
            <img src="../imagens/icones/facebook.svg">
            <img src="../imagens/icones/twitter.svg">
            <img src="../imagens/icones/youtube.svg">
            <img src="../imagens/icones/linkedin.svg">
            <img src="../imagens/icones/instagram.svg">
            <img src="../imagens/icones/whatsapp.svg">
        </div>

        <div id="informacoes">

            <div id="localizacao">
                <h3 id="localizacao-title">EDIFÍCIO SEDE FIESP</h3>
                <p>Av. Paulista, 1313, São Paulo/SP</p>
                <p>CEP 01311-923</p>
            </div>

            <div id="atendimento">
                <div id="alinhamento">
                    <h3 id="atendimento-title">CENTRAL DE RELACIONAMENTO</h3>
                    <p>(11) 3322-0050 (Telefone/WhatsApp)</p>
                    <p>0800-055-1000 (Interior de SP, somente telefone fixo</p>
                </div>
            </div>

            <div id="informacoes-links">
                <a href="">Unidades</a>
                <a href="">O SENAI</a>
                <a href="">Perguntas Frequentes</a>
                <a href="">Fale Conosco</a>
                <a href="">Transparência</a>
                <a href="">Para a sua empresa</a>
            </div>
        </div>

        <div id="copyright">
            <p>Copyright 2024 © Todos os direitos reservados.</p>
        </div>
    </footer>
</body>
</html>

